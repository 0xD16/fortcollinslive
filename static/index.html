<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no minimum-scale=1"
    />
    <meta
      name="viewport"
      content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, target-densitydpi=device-dpi"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <script>
    function populateTableFromJSONFile(jsonFilePath, tableId, tableId2) {
      fetch(jsonFilePath)
        .then((response) => response.json())
        .then((jsonData) => {
          const currentDate = new Date();
          const currentYear = currentDate.getFullYear();
          const table = document.getElementById(tableId);
          const table2 = document.getElementById(tableId2);
          const tbody = table.createTBody();
          const tbody2 = table2.createTBody();
          jsonData.forEach((item) => {
            const dateParts = item["Date"].split("/");
            let eventYear = parseInt(dateParts[2]);
            if (dateParts.length === 3 && dateParts[2].length === 2) {
              eventYear += eventYear < 100 ? 2000 : 1900;
            }
            const itemDate = new Date(
              eventYear,
              dateParts[0] - 1,
              dateParts[1]
            );
            if (
              isNaN(itemDate.getTime()) ||
              eventYear > currentYear ||
              (eventYear === currentYear && itemDate > currentDate) ||
              item["Date"].includes("NONE")
            ) {
              const newRow = tbody.insertRow();
              Object.keys(item).forEach((key) => {
                if (
                  key !== "Field 6" &&
                  key !== "Field 7" &&
                  key !== "Status" &&
                  key !== "Date Select"
                ) {
                  const newCell = newRow.insertCell();
                  newCell.textContent = item[key];
                }
              });
            } else {
              const newRow2 = tbody2.insertRow();
              Object.keys(item).forEach((key) => {
                // Skip columns "Field 6", "Field 7", and "Status"
                if (
                  key !== "Field 6" &&
                  key !== "Field 7" &&
                  key !== "Status" &&
                  key !== "Date Select"
                ) {
                  const newCell2 = newRow2.insertCell();
                  newCell2.textContent = item[key];
                }
              });
            }
          });
        })
        .catch((error) => console.error("Error:", error));
    }
  </script>

  <body>
    <header>
      <div class="header d-flex">
        <img class="logo" src="images/Icon.png" alt="logoimage" />
        <label class="headerlabel">Fortcollinslive</label>
      </div>
      <div class="banner">
        <label class="text">Fort Collins Live Music</label>
        <div
          class="nav nav-tabs eventtabs parentWeb"
          id="nav-tab"
          role="tablist"
        >
          <div class="row" style="width: 100%">
            <div class="col-md-6 col-6 tabslabel">
              <button
                class="btn nav-link active blue"
                id="nav-upcoming-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-upcoming"
                type="button"
                role="tab"
                aria-controls="nav-upcoming"
                aria-selected="true"
              >
                Upcoming Events
              </button>
            </div>

            <div class="col-md-6 col-6 tabslabel">
              <button
                class="btn nav-link"
                id="nav-past-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-past"
                type="button"
                role="tab"
                aria-controls="nav-past"
                aria-selected="true"
              >
                Past Events
              </button>
            </div>
          </div>
        </div>
        <div class="filtertab d-inline parentWeb">
          <select
            class="form-control"
            id="costFilter"
            style="width: 100px; float: right !important"
          >
            <option value="all" selected style="color: black">
              Price Filter
            </option>
            <option value="free">Free</option>
            <option value="5-10">$5-$10</option>
            <option value="10-20">$10-$20</option>
            <option value="20+">$20+</option>
          </select>
          <span class="hamburger-icon" style="float: right; margin-top: 5px"
            >&#9776;</span
          >
        </div>
        <div class="flex">
          <div
            class="nav nav-tabs eventtabs parentMob widthmob"
            id="nav-tab"
            role="tablist"
          >
            <div class="row" style="width: 100%">
              <div class="col-md-6 col-6 tabslabel">
                <button
                  class="btn nav-link active blue"
                  id="nav-upcoming-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#nav-upcoming"
                  type="button"
                  role="tab"
                  aria-controls="nav-upcoming"
                  aria-selected="true"
                >
                  Upcoming Events
                </button>
              </div>

              <div class="col-md-6 col-6 tabslabel">
                <button
                  class="btn nav-link pink"
                  id="nav-past-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#nav-past"
                  type="button"
                  role="tab"
                  aria-controls="nav-past"
                  aria-selected="true"
                >
                  Past Events
                </button>
              </div>
            </div>
          </div>
          <div class="filtertab d-inline parentMob widthFil">
            <select
              class="form-control"
              id="costFilter"
              style="width: 100px; float: right !important"
            >
              <option value="all" selected style="color: black">
                Price Filter
              </option>
              <option value="free">Free</option>
              <option value="5-10">$5-$10</option>
              <option value="10-20">$10-$20</option>
              <option value="20+">$20+</option>
            </select>
            <span class="hamburger-icon" style="float: right; margin-top: 5px"
              >&#9776;</span
            >
          </div>
        </div>
        <!-- <div class="parentMob">
          <div class="nav nav-tabs eventtabs" id="nav-tab" role="tablist">
            <div class="row" style="width: 100%">
              <div class="col-md-6 col-6 tabslabel">
                <button
                  class="btn nav-link active blue"
                  id="nav-upcoming-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#nav-upcoming"
                  type="button"
                  role="tab"
                  aria-controls="nav-upcoming"
                  aria-selected="true"
                >
                  Upcoming Events
                </button>
              </div>

              <div class="col-md-6 col-6 tabslabel">
                <button
                  class="btn nav-link"
                  id="nav-past-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#nav-past"
                  type="button"
                  role="tab"
                  aria-controls="nav-past"
                  aria-selected="true"
                >
                  Past Events
                </button>
              </div>
            </div>
          </div>
          <div class="filtertab d-inline">
            <select
              class="form-control"
              id="costFilter"
              style="width: 100px; float: right !important"
            >
              <option value="all" selected style="color: black">
                Price Filter
              </option>
              <option value="free">Free</option>
              <option value="5-10">$5-$10</option>
              <option value="10-20">$10-$20</option>
              <option value="20+">$20+</option>
            </select>
            <span class="hamburger-icon" style="float: right; margin-top: 5px"
              >&#9776;</span
            >
          </div>
        </div> -->
      </div>
    </header>
    <div class="tab-content" id="nav-tabContent">
      <div
        class="tab-pane fade show active"
        id="nav-upcoming"
        role="tabpanel"
        aria-labelledby="nav-upcoming-tab"
      >
        <div class="container">
          <div class="table-container">
            <table class="table table-striped" id="dataTable">
              <thead class="tableheader" id="header">
                <tr>
                  <th
                    class="heading blue"
                    scope="col"
                    style="border-top-left-radius: 20px"
                  >
                    Bar or Venue Name
                  </th>
                  <th class="heading blue" scope="col">Date</th>
                  <th class="heading blue" scope="col">Music Start Time</th>
                  <th class="heading blue" scope="col">
                    Band /DJ/ Musician Name
                  </th>
                  <th class="heading blue" scope="col">Cost</th>
                  <th
                    class="heading blue"
                    scope="col"
                    style="border-top-right-radius: 20px; border-right: none"
                  >
                    "Specials" at Venue
                  </th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div
        class="tab-pane fade"
        id="nav-past"
        role="tabpanel"
        aria-labelledby="nav-past-tab"
      >
        <div class="container">
          <div class="table-container">
            <table class="table table-striped" id="datatable2">
              <thead class="tableheader" id="header">
                <tr>
                  <th
                    class="heading2 pink"
                    scope="col"
                    style="border-top-left-radius: 20px"
                  >
                    Bar or Venue Name
                  </th>
                  <th class="heading2 pink" scope="col">Date</th>
                  <th class="heading2 pink" scope="col">Music Start Time</th>
                  <th class="heading2 pink" scope="col">
                    Band /DJ/ Musician Name
                  </th>
                  <th class="heading2 pink" scope="col">Cost</th>
                  <th
                    class="heading2 pink"
                    scope="col"
                    style="border-top-right-radius: 20px; border-right: none"
                  >
                    "Specials" at Venue
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div style="display: flex; justify-content: center; align-items: center">
        <img src="images/whiteicon.png" alt="logo" class="footerlogo" />
        <label class="footerlabel">Fortcollinslive</label>
      </div>
      <div
        style="
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
        "
      >
        <label class="footertext">Are we missing your live music venue?</label>
        <label class="footertext"> Contact us to get on the list! </label>
      </div>
    </div>
    <script>
      populateTableFromJSONFile(
        "https://api.us.dev/foco-live/events",
        "dataTable",
        "datatable2"
      );
    </script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var header = document.getElementById("header");
      var headerOffset = header.offsetTop;
      var fixedClassAdded = false;

      function handleScroll() {
        if (window.pageYOffset >= headerOffset && !fixedClassAdded) {
          header.classList.add("fixed-header");
          fixedClassAdded = true;
        } else if (window.pageYOffset < headerOffset && fixedClassAdded) {
          header.classList.remove("fixed-header");
          fixedClassAdded = false;
        }
      }
      handleScroll();
      window.addEventListener("scroll", handleScroll);
    });
    document
      .getElementById("costFilter")
      .addEventListener("change", function () {
        var filter = this.value;
        var rows = document.querySelectorAll("#dataTable tbody tr");
        var rows2 = document.querySelectorAll("#datatable2 tbody tr");
        rows.forEach(function (row) {
          var costCell = row.querySelector("td:nth-child(5)"); // Selecting the fifth column (Cost)
          if (costCell) {
            if (filter === "all" || costMatches(costCell.textContent, filter)) {
              row.style.display = "";
            } else {
              row.style.display = "none";
            }
          }
        });
        rows2.forEach(function (row2) {
          var costCell2 = row2.querySelector("td:nth-child(5)"); // Selecting the fifth column (Cost)
          if (costCell2) {
            if (
              filter === "all" ||
              costMatches(costCell2.textContent, filter)
            ) {
              row2.style.display = "";
            } else {
              row2.style.display = "none";
            }
          }
        });
      });
    function costMatches(cost, filter) {
      if (filter === "free" && cost.toLowerCase().includes("free")) {
        return true;
      } else if (filter === "20+" && parseFloat(getCostValue(cost)) >= 20) {
        return true;
      } else {
        var range = filter.split("-");
        if (range.length === 2) {
          var min = parseFloat(range[0].replace("$", ""));
          var max = parseFloat(range[1].replace("$", ""));
          var costVal = getCostValue(cost);
          return costVal >= min && costVal <= max;
        }
      }
      return false;
    }
    function getCostValue(costText) {
      var matches = costText.match(/\$\d+(\.\d+)?/);
      return matches ? parseFloat(matches[0].replace("$", "")) : 0;
    }
  </script>
</html>
